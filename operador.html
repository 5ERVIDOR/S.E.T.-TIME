<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Produtividade do Operador</title>
<style>
body {
  font-family: Arial, sans-serif;
  background: url('https://img.freepik.com/fotos-premium/cronometro-no-fundo-desfocado_175024-13.jpg') no-repeat center center fixed;
  background-size: cover;
  padding: 5vw;
  text-align: center;
  color: #0f0;
  position: relative;
  min-height: 100vh;
}
body::before {
  content: "";
  position: absolute;
  top: 0; left: 0;
  width: 100%; height: 100%;
  background-color: rgba(0,0,0,0.85);
  z-index: 0;
}
h1, a, .display-container, button, .log, .modal {
  position: relative;
  z-index: 1;
}
h1 {
  font-size: 8vw;
  margin-bottom: 4vw;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 2vw;
}
a {
  text-decoration: none;
  color: #0f0;
  font-size: 4vw;
  margin-bottom: 4vw;
  display: inline-block;
}
.display-container {
  background: #111;
  color: #0f0;
  padding: 4vw;
  border-radius: 2vw;
  margin: auto;
  margin-bottom: 3vw;
  width: 85%;
  max-width: 420px;
  box-shadow: 0 0 10px #0f0;
}
.display {
  font-size: 18vw;
  font-family: monospace;
  font-weight: bold;
  text-shadow: 0 0 20px #0f0;
}
.partial-display {
  font-size: 10vw;
  margin-top: 2vw;
  text-shadow: 0 0 10px #0f0;
}
.subtitle {
  font-size: 5vw;
  margin-top: 1vw;
}
button {
  padding: 3vw 5vw;
  margin: 2vw;
  border: none;
  border-radius: 3vw;
  font-weight: bold;
  font-size: 5vw;
  cursor: pointer;
  transition: 0.12s;
}
button:hover { transform: translateY(-2px); }
.start { background: #28a745; color: white; }
.stop { background: #dc3545; color: white; }
.reset { background: #6c757d; color: white; }
.summary { background: #ffc107; color: black; }
.register { background: #007bff; color: white; width: 90%; margin-top: 3vw; font-size: 5vw; }
.log { margin-top: 4vw; max-width: 95%; margin-left: auto; margin-right: auto; }
table {
  width: 100%;
  border-collapse: collapse;
  margin-top: 2vw;
  font-size: 4vw;
}
th, td {
  border: 1px solid #ccc;
  padding: 2vw;
  text-align: center;
}
th { background: #007bff; color: white; }

/* Modal (Resumo) */
.modal {
  display: none;
  position: fixed;
  z-index: 10;
  left: 0; top: 0;
  width: 100%; height: 100%;
  background-color: rgba(0,0,0,0.8);
}
.modal-content {
  background: #111;
  margin: 12% auto;
  padding: 18px;
  border-radius: 15px;
  width: 90%;
  max-width: 420px;
  color: #0f0;
  box-shadow: 0 0 15px #0f0;
  text-align: center;
}
.modal-content h3 {
  margin-top: 0;
  text-shadow: 0 0 10px #0f0;
}
.modal-content p {
  font-size: 5vw;
  margin: 8px 0;
}
.close-btn {
  background: #dc3545;
  color: white;
  border: none;
  padding: 10px 20px;
  border-radius: 10px;
  font-size: 5vw;
  cursor: pointer;
  margin-top: 12px;
}
@media (min-width:768px) {
  h1 { font-size: 36px; gap: 8px; }
  a { font-size: 18px; }
  .display-container { padding: 30px; border-radius: 15px; max-width: 380px; }
  .display { font-size: 90px; }
  .partial-display { font-size: 45px; }
  .subtitle { font-size: 20px; }
  button { font-size: 18px; padding: 10px 18px; border-radius: 10px; }
  table { font-size: 18px; }
  .modal-content p { font-size: 16px; }
  .close-btn { font-size: 16px; padding: 8px 14px; }
}
</style>
</head>
<body>
<h1>üë§ Produtividade do Operador</h1>
<a href="index.html">‚¨Ö Voltar</a>

<div class="display-container">
  <div id="display" class="display">0.000</div>
  <div class="subtitle">M.CCC (minutos centezimais)</div>
  <div id="partialDisplay" class="partial-display">Tempo Parcial: 0.000</div>
</div>

<div>
  <button class="start" id="startBtn">‚ñ∂ Iniciar</button>
  <button class="stop" id="stopBtn" disabled>‚è∏ Parar</button>
  <button class="reset" id="resetBtn">‚ü≥ Resetar</button>
  <button class="summary" id="summaryBtn">üìä Resumo</button>
</div>

<button class="register" id="registerBtn" disabled>üíæ Registrar Tempo</button>

<div class="log">
  <h2>Registros</h2>
  <table id="logTable">
    <thead>
      <tr>
        <th>#</th>
        <th>Tempo Bruto (min)</th>
        <th>Pares por dia</th>
        <th>Pares por hora</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
</div>

<!-- Modal Resumo -->
<div id="summaryModal" class="modal">
  <div class="modal-content">
    <h3>üìä Resumo de Produtividade</h3>
    <p id="summaryText">Calculando...</p>
    <button id="closeModalBtn" class="close-btn">Fechar</button>
  </div>
</div>

<script>
let totalTime = 0, partialTime = 0, interval = null, running = false, registerCount = 0;

const display = document.getElementById("display");
const partialDisplay = document.getElementById("partialDisplay");
const startBtn = document.getElementById("startBtn");
const stopBtn = document.getElementById("stopBtn");
const resetBtn = document.getElementById("resetBtn");
const registerBtn = document.getElementById("registerBtn");
const summaryBtn = document.getElementById("summaryBtn");
const logTableBody = document.querySelector("#logTable tbody");
const modal = document.getElementById("summaryModal");
const summaryText = document.getElementById("summaryText");
const closeModalBtn = document.getElementById("closeModalBtn");

/**
 * Unidades internas: 1 unidade = 60 ms.
 * 1000 unidades = 1 minuto.
 * formatTime recebe unidades e mostra M.CCC (minutos.centezimal).
 */
function formatTime(centezimalUnits){
  const totalMinutes = centezimalUnits / 1000;
  const minutes = Math.floor(totalMinutes);
  const cPart = Math.round((totalMinutes - minutes) * 1000);
  return `${minutes}.${cPart.toString().padStart(3,'0')}`;
}

function updateDisplay(){
  display.textContent = formatTime(totalTime);
  partialDisplay.textContent = "Tempo Parcial: " + formatTime(partialTime);
}

function start(){
  if(!running){
    running = true;
    interval = setInterval(() => {
      totalTime++;
      partialTime++;
      updateDisplay();
    }, 60);
    startBtn.disabled = true;
    stopBtn.disabled = false;
    registerBtn.disabled = false;
  }
}

function stop(){
  running = false;
  clearInterval(interval);
  startBtn.disabled = false;
  stopBtn.disabled = true;
}

function reset(){
  totalTime = 0;
  partialTime = 0;
  updateDisplay();
  logTableBody.innerHTML = "";
  registerCount = 0;
  stop();
  registerBtn.disabled = true;
}

// Ao registrar, armazenamos tamb√©m os "units" (partialTime) como data-units no <td>
function register(){
  if(partialTime === 0) return;
  const units = partialTime; // unidades internas (inteiro)
  const minBruto = units / 1000; // minutos (float)
  const paresDia = minBruto === 0 ? 0 : (528 / minBruto).toFixed(2);
  const paresHora = minBruto === 0 ? 0 : (60 / minBruto).toFixed(2);

  registerCount++;
  const row = document.createElement("tr");
  // armazenar units no atributo data-units do <td> para c√°lculo exato depois
  row.innerHTML = `<td>${registerCount}</td>
                   <td data-units="${units}">${minBruto.toFixed(3)}</td>
                   <td>${paresDia}</td>
                   <td>${paresHora}</td>`;
  logTableBody.appendChild(row);

  partialTime = 0;
  updateDisplay();
}

/* 
 showSummary:
 - pausa o cron√¥metro
 - soma os data-units de cada registro (valores exatos inteiros)
 - calcula m√©dia em unidades, converte para minutos m√©dios
 - calcula pares/hora = 60 / mediaMinutos e pares/dia = 528 / mediaMinutos
*/
function showSummary(){
  stop(); // pausa o cron√¥metro automaticamente

  const rows = logTableBody.querySelectorAll("tr");
  if(rows.length === 0){
    summaryText.innerHTML = "Nenhum registro encontrado.<br>Registre pelo menos um tempo antes de gerar o resumo.";
    modal.style.display = "block";
    return;
  }

  let totalUnits = 0;
  rows.forEach(r => {
    const td = r.children[1];
    const unitsAttr = td.getAttribute('data-units');
    const units = parseInt(unitsAttr, 10);
    if(!isNaN(units)) totalUnits += units;
  });

  const n = rows.length;
  const avgUnits = totalUnits / n; // m√©dia em unidades (pode ser float)
  const avgMinutes = avgUnits / 1000; // m√©dia em minutos

  // Formatar tempo m√©dio: convertemos a m√©dia de unidades para o formato M.CCC (arredondando unidades)
  const avgUnitsRounded = Math.round(avgUnits);
  const tempoMedioFormatado = formatTime(avgUnitsRounded);

  // Calcular pares/hora e pares/dia com base no tempo m√©dio exato (n√£o arredondado)
  const paresHora = avgMinutes === 0 ? 0 : (60 / avgMinutes);
  const paresDia = avgMinutes === 0 ? 0 : (528 / avgMinutes);

  summaryText.innerHTML = `
    <strong>Registros:</strong> ${n}<br>
    <strong>Tempo m√©dio:</strong> ${tempoMedioFormatado} min<br>
    <strong>M√©dia pares/dia:</strong> ${paresDia.toFixed(2)}<br>
    <strong>M√©dia pares/hora:</strong> ${paresHora.toFixed(2)}
  `;

  modal.style.display = "block";
}

function closeModal(){
  modal.style.display = "none";
}

startBtn.onclick = start;
stopBtn.onclick = stop;
resetBtn.onclick = reset;
registerBtn.onclick = register;
summaryBtn.onclick = showSummary;
closeModalBtn.onclick = closeModal;
window.onclick = e => { if(e.target === modal) modal.style.display = "none"; };

updateDisplay();
</script>
</body>
</html>
