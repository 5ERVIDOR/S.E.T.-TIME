<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Produtividade do Operador</title>
<style>
body { font-family:Arial,sans-serif; background:url('https://img.freepik.com/fotos-premium/cronometro-no-fundo-desfocado_175024-13.jpg') no-repeat center center fixed; background-size:cover; padding:5vw; text-align:center; color:#0f0; position:relative; min-height:100vh;}
body::before { content:""; position:absolute; top:0; left:0; width:100%; height:100%; background-color: rgba(0,0,0,0.85); z-index:0;}
h1,a,.display-container,button,.log { position:relative; z-index:1; }
h1 { font-size:8vw; margin-bottom:4vw; display:flex; align-items:center; justify-content:center; gap:2vw; }
a { text-decoration:none; color:#0f0; font-size:4vw; margin-bottom:4vw; display:inline-block; }
.display-container { background:#111; color:#0f0; padding:8vw; border-radius:4vw; margin:auto; margin-bottom:4vw; width:90%; max-width:500px;}
.display { font-size:18vw; font-family:monospace; font-weight:bold; text-shadow:0 0 20px #0f0; }
.partial-display { font-size:10vw; margin-top:2vw; text-shadow:0 0 10px #0f0; }
.subtitle { font-size:5vw; margin-top:1vw; }
button { padding:3vw 5vw; margin:2vw; border:none; border-radius:3vw; font-weight:bold; font-size:5vw; cursor:pointer; transition:0.2s; }
button:hover { opacity:0.9; transform:scale(1.05); }
.start { background:#28a745; color:white; }
.stop { background:#dc3545; color:white; }
.reset { background:#6c757d; color:white; }
.summary { background:#ffc107; color:black; }
.register { background:#007bff; color:white; width:90%; margin-top:3vw; font-size:5vw; }
.log { margin-top:4vw; max-width:95%; margin-left:auto; margin-right:auto; }
table { width:100%; border-collapse: collapse; margin-top:2vw; font-size:4vw; }
th, td { border:1px solid #ccc; padding:2vw; text-align:center; }
th { background:#007bff; color:white; }

/* üîπ Estilos do modal */
.modal-overlay {
  position: fixed;
  top: 0; left: 0;
  width: 100%; height: 100%;
  background-color: rgba(0,0,0,0.7);
  display: none;
  justify-content: center;
  align-items: center;
  z-index: 999;
}
.modal {
  background-color: #111;
  border: 2px solid #0f0;
  border-radius: 15px;
  padding: 30px;
  width: 90%;
  max-width: 400px;
  color: #0f0;
  text-align: center;
  box-shadow: 0 0 20px #0f0;
  animation: fadeIn 0.3s ease-in-out;
}
.modal h2 {
  margin-bottom: 15px;
  font-size: 6vw;
}
.modal p {
  font-size: 4.5vw;
  margin: 8px 0;
}
.close-btn {
  margin-top: 20px;
  background: #0f0;
  color: #000;
  font-weight: bold;
  border: none;
  border-radius: 8px;
  padding: 10px 20px;
  cursor: pointer;
  font-size: 4.5vw;
}
.close-btn:hover {
  background: #9f9;
}
@keyframes fadeIn {
  from { opacity: 0; transform: scale(0.8); }
  to { opacity: 1; transform: scale(1); }
}
@media(min-width:768px){
  h1{ font-size:36px; gap:8px; }
  a{ font-size:18px; }
  .display-container{ padding:40px; border-radius:15px;}
  .display{ font-size:90px; }
  .partial-display{ font-size:50px; }
  .subtitle{ font-size:20px; }
  button{ font-size:18px; padding:15px 25px; border-radius:10px; }
  table{ font-size:18px; }
  .modal h2{ font-size:24px; }
  .modal p{ font-size:18px; }
  .close-btn{ font-size:18px; }
}
</style>
</head>
<body>
<h1>üë§ Produtividade do Operador</h1>
<a href="index.html">‚¨Ö Voltar</a>

<div class="display-container">
  <div id="display" class="display">0.000</div>
  <div class="subtitle">M.CCC (minutos centezimais)</div>
  <div id="partialDisplay" class="partial-display">Tempo Parcial: 0.000</div>
</div>

<div>
  <button class="start" id="startBtn">‚ñ∂ Iniciar</button>
  <button class="stop" id="stopBtn" disabled>‚è∏ Parar</button>
  <button class="reset" id="resetBtn">‚ü≥ Resetar</button>
  <button class="summary" id="summaryBtn">üìä Resumo</button>
</div>

<button class="register" id="registerBtn" disabled>üíæ Registrar Tempo</button>

<div class="log">
  <h2>Registros</h2>
  <table id="logTable">
    <thead>
      <tr>
        <th>#</th>
        <th>Tempo Bruto</th>
        <th>Pares por dia</th>
        <th>Pares por hora</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
</div>

<!-- üîπ Modal de resumo -->
<div class="modal-overlay" id="summaryModal">
  <div class="modal">
    <h2>üìä Resumo de Produtividade</h2>
    <p id="summaryText">Carregando...</p>
    <button class="close-btn" id="closeModalBtn">Fechar</button>
  </div>
</div>

<script>
let totalTime=0, partialTime=0, interval=null, running=false, registerCount=0;

const display = document.getElementById("display");
const partialDisplay = document.getElementById("partialDisplay");
const startBtn = document.getElementById("startBtn");
const stopBtn = document.getElementById("stopBtn");
const resetBtn = document.getElementById("resetBtn");
const registerBtn = document.getElementById("registerBtn");
const summaryBtn = document.getElementById("summaryBtn");
const logTableBody = document.querySelector("#logTable tbody");
const modal = document.getElementById("summaryModal");
const summaryText = document.getElementById("summaryText");
const closeModalBtn = document.getElementById("closeModalBtn");

function formatTime(centezimalUnits){
  const totalMinutes = centezimalUnits / 1000;
  const minutes = Math.floor(totalMinutes);
  const cPart = Math.round((totalMinutes - minutes) * 1000);
  return `${minutes}.${cPart.toString().padStart(3,'0')}`;
}

function updateDisplay(){
  display.textContent = formatTime(totalTime);
  partialDisplay.textContent = "Tempo Parcial: " + formatTime(partialTime);
}

function start(){
  if(!running){
    running = true;
    interval = setInterval(() => {
      totalTime++;
      partialTime++;
      updateDisplay();
    }, 60);
    startBtn.disabled = true;
    stopBtn.disabled = false;
    registerBtn.disabled = false;
  }
}

function stop(){
  running = false;
  clearInterval(interval);
  startBtn.disabled = false;
  stopBtn.disabled = true;
}

function reset(){
  totalTime = 0;
  partialTime = 0;
  updateDisplay();
  logTableBody.innerHTML = "";
  registerCount = 0;
  stop();
  registerBtn.disabled = true;
}

// Fun√ß√£o registrar
function register(){
  if(partialTime === 0) return;
  registerCount++;
  const minBruto = partialTime / 1000;
  const paresDia = (528 / minBruto).toFixed(2);
  const paresHora = (60 / minBruto).toFixed(2);
  const row = document.createElement("tr");
  row.innerHTML = `<td>${registerCount}</td><td>${formatTime(partialTime)}</td><td>${paresDia}</td><td>${paresHora}</td>`;
  logTableBody.appendChild(row);
  partialTime = 0;
  updateDisplay();
}

// üîπ Fun√ß√£o mostrar resumo (agora pausa o tempo antes)
function showSummary() {
  // üî∏ Pausa o cron√¥metro automaticamente
  stop();

  const rows = logTableBody.querySelectorAll("tr");
  if (rows.length === 0) {
    summaryText.innerHTML = "Nenhum registro encontrado.<br>Fa√ßa pelo menos um registro para gerar o resumo.";
    modal.style.display = "flex";
    return;
  }

  let totalTempo = 0, totalParesDia = 0, totalParesHora = 0;

  rows.forEach(row => {
    const cols = row.querySelectorAll("td");
    const tempoBruto = parseFloat(cols[1].textContent);
    const paresDia = parseFloat(cols[2].textContent);
    const paresHora = parseFloat(cols[3].textContent);

    totalTempo += tempoBruto;
    totalParesDia += paresDia;
    totalParesHora += paresHora;
  });

  const n = rows.length;
  const mediaTempo = (totalTempo / n).toFixed(3);
  const mediaDia = (totalParesDia / n).toFixed(2);
  const mediaHora = (totalParesHora / n).toFixed(2);

  summaryText.innerHTML = `
    <strong>Registros:</strong> ${n}<br>
    <strong>Tempo m√©dio:</strong> ${mediaTempo} min<br>
    <strong>M√©dia pares/dia:</strong> ${mediaDia}<br>
    <strong>M√©dia pares/hora:</strong> ${mediaHora}
  `;

  modal.style.display = "flex";
}

// Fechar modal
closeModalBtn.onclick = () => modal.style.display = "none";
window.onclick = (e) => { if (e.target === modal) modal.style.display = "none"; };

startBtn.onclick = start;
stopBtn.onclick = stop;
resetBtn.onclick = reset;
registerBtn.onclick = register;
summaryBtn.onclick = showSummary;

updateDisplay();
</script>
</body>
</html>
